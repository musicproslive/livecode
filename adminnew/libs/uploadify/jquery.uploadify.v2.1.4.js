if(jQuery)(function(e){e.extend(e.fn,{uploadify:function(t){e(this).each(function(){var n=e.extend({id:e(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:120,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",removeCompleted:true,onInit:function(){},onSelect:function(){},onSelectOnce:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},t);e(this).data("settings",n);var r=location.pathname;r=r.split("/");r.pop();r=r.join("/")+"/";var i={};i.uploadifyID=n.id;i.pagepath=r;if(n.buttonImg)i.buttonImg=escape(n.buttonImg);if(n.buttonText)i.buttonText=escape(n.buttonText);if(n.rollover)i.rollover=true;i.script=n.script;i.folder=escape(n.folder);if(n.scriptData){var s="";for(var o in n.scriptData){s+="&"+o+"="+n.scriptData[o]}i.scriptData=escape(s.substr(1))}i.width=n.width;i.height=n.height;i.wmode=n.wmode;i.method=n.method;i.queueSizeLimit=n.queueSizeLimit;i.simUploadLimit=n.simUploadLimit;if(n.hideButton)i.hideButton=true;if(n.fileDesc)i.fileDesc=n.fileDesc;if(n.fileExt)i.fileExt=n.fileExt;if(n.multi)i.multi=true;if(n.auto)i.auto=true;if(n.sizeLimit)i.sizeLimit=n.sizeLimit;if(n.checkScript)i.checkScript=n.checkScript;if(n.fileDataName)i.fileDataName=n.fileDataName;if(n.queueID)i.queueID=n.queueID;if(n.onInit()!==false){e(this).css("display","none");e(this).after('<div id="'+e(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(n.uploader,n.id+"Uploader",n.width,n.height,"9.0.24",n.expressInstall,i,{quality:"high",wmode:n.wmode,allowScriptAccess:n.scriptAccess},{},function(e){if(typeof n.onSWFReady=="function"&&e.success)n.onSWFReady()});if(n.queueID==false){e("#"+e(this).attr("id")+"Uploader").after('<div id="'+e(this).attr("id")+'Queue" class="uploadifyQueue"></div>')}else{e("#"+n.queueID).addClass("uploadifyQueue")}}if(typeof n.onOpen=="function"){e(this).bind("uploadifyOpen",n.onOpen)}e(this).bind("uploadifySelect",{action:n.onSelect,queueID:n.queueID},function(t,r,i){if(t.data.action(t,r,i)!==false){var s=Math.round(i.size/1024*100)*.01;var o="KB";if(s>1e3){s=Math.round(s*.001*100)*.01;o="MB"}var u=s.toString().split(".");if(u.length>1){s=u[0]+"."+u[1].substr(0,2)}else{s=u[0]}if(i.name.length>20){fileName=i.name.substr(0,20)+"..."}else{fileName=i.name}queue="#"+e(this).attr("id")+"Queue";if(t.data.queueID){queue="#"+t.data.queueID}e(queue).append('<div id="'+e(this).attr("id")+r+'" class="uploadifyQueueItem">								<div class="cancel">									<a href="javascript:jQuery(\'#'+e(this).attr("id")+"').uploadifyCancel('"+r+'\')"><img src="'+n.cancelImg+'" border="0" /></a>								</div>								<span class="fileName">'+fileName+" ("+s+o+')</span><span class="percentage"></span>								<div class="uploadifyProgress">									<div id="'+e(this).attr("id")+r+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div>								</div>							</div>')}});e(this).bind("uploadifySelectOnce",{action:n.onSelectOnce},function(t,r){t.data.action(t,r);if(n.auto){if(n.checkScript){e(this).uploadifyUpload(null,false)}else{e(this).uploadifyUpload(null,true)}}});e(this).bind("uploadifyQueueFull",{action:n.onQueueFull},function(e,t){if(e.data.action(e,t)!==false){alert("The queue is full.  The max size is "+t+".")}});e(this).bind("uploadifyCheckExist",{action:n.onCheck},function(t,n,i,s,o){var u=new Object;u=i;u.folder=s.substr(0,1)=="/"?s:r+s;if(o){for(var a in i){var f=a}}e.post(n,u,function(n){for(var r in n){if(t.data.action(t,n,r)!==false){var i=confirm("Do you want to replace the file "+n[r]+"?");if(!i){document.getElementById(e(t.target).attr("id")+"Uploader").cancelFileUpload(r,true,true)}}}if(o){document.getElementById(e(t.target).attr("id")+"Uploader").startFileUpload(f,true)}else{document.getElementById(e(t.target).attr("id")+"Uploader").startFileUpload(null,true)}},"json")});e(this).bind("uploadifyCancel",{action:n.onCancel},function(t,n,r,i,s,o){if(t.data.action(t,n,r,i,o)!==false){if(s){var u=o==true?0:250;e("#"+e(this).attr("id")+n).fadeOut(u,function(){e(this).remove()})}}});e(this).bind("uploadifyClearQueue",{action:n.onClearQueue},function(t,r){var i=n.queueID?n.queueID:e(this).attr("id")+"Queue";if(r){e("#"+i).find(".uploadifyQueueItem").remove()}if(t.data.action(t,r)!==false){e("#"+i).find(".uploadifyQueueItem").each(function(){var t=e(".uploadifyQueueItem").index(this);e(this).delay(t*100).fadeOut(250,function(){e(this).remove()})})}});var u=[];e(this).bind("uploadifyError",{action:n.onError},function(t,n,r,i){if(t.data.action(t,n,r,i)!==false){var s=new Array(n,r,i);u.push(s);e("#"+e(this).attr("id")+n).find(".percentage").text(" - "+i.type+" Error");e("#"+e(this).attr("id")+n).find(".uploadifyProgress").hide();e("#"+e(this).attr("id")+n).addClass("uploadifyError")}});if(typeof n.onUpload=="function"){e(this).bind("uploadifyUpload",n.onUpload)}e(this).bind("uploadifyProgress",{action:n.onProgress,toDisplay:n.displayData},function(t,n,r,i){if(t.data.action(t,n,r,i)!==false){e("#"+e(this).attr("id")+n+"ProgressBar").animate({width:i.percentage+"%"},250,function(){if(i.percentage==100){e(this).closest(".uploadifyProgress").fadeOut(250,function(){e(this).remove()})}});if(t.data.toDisplay=="percentage")displayData=" - "+i.percentage+"%";if(t.data.toDisplay=="speed")displayData=" - "+i.speed+"KB/s";if(t.data.toDisplay==null)displayData=" ";e("#"+e(this).attr("id")+n).find(".percentage").text(displayData)}});e(this).bind("uploadifyComplete",{action:n.onComplete},function(t,r,i,s,o){if(t.data.action(t,r,i,unescape(s),o)!==false){e("#"+e(this).attr("id")+r).find(".percentage").text(" - Completed");if(n.removeCompleted){e("#"+e(t.target).attr("id")+r).fadeOut(250,function(){e(this).remove()})}e("#"+e(t.target).attr("id")+r).addClass("completed")}});if(typeof n.onAllComplete=="function"){e(this).bind("uploadifyAllComplete",{action:n.onAllComplete},function(e,t){if(e.data.action(e,t)!==false){u=[]}})}})},uploadifySettings:function(t,n,r){var i=false;e(this).each(function(){if(t=="scriptData"&&n!=null){if(r){var s=n}else{var s=e.extend(e(this).data("settings").scriptData,n)}var o="";for(var u in s){o+="&"+u+"="+s[u]}n=escape(o.substr(1))}i=document.getElementById(e(this).attr("id")+"Uploader").updateSettings(t,n)});if(n==null){if(t=="scriptData"){var s=unescape(i).split("&");var o=new Object;for(var u=0;u<s.length;u++){var a=s[u].split("=");o[a[0]]=a[1]}i=o}}return i},uploadifyUpload:function(t,n){e(this).each(function(){if(!n)n=false;document.getElementById(e(this).attr("id")+"Uploader").startFileUpload(t,n)})},uploadifyCancel:function(t){e(this).each(function(){document.getElementById(e(this).attr("id")+"Uploader").cancelFileUpload(t,true,true,false)})},uploadifyClearQueue:function(){e(this).each(function(){document.getElementById(e(this).attr("id")+"Uploader").clearFileUploadQueue(false)})}})})(jQuery)