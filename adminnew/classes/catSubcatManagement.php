<?php/**************************************************************************************Created By 	:	milanmilan PranavCreated On	:	27-09-2012Description	:	Manage User Abuses **************************************************************************************/class catSubcatManagement extends siteclass{			public function getAllFlags($dropdown)		{	if($dropdown==1)			{				$sql="SELECT * FROM tbl_flag WHERE pid=0 ORDER BY id ASC";				$results 	= 	$this->getdbcontents_sql($sql);								return $results ;			}			else			{				$sql="SELECT * FROM tbl_flag WHERE pid=0 ORDER BY id ASC";				$results_all	= 	$this->getdbcontents_sql($sql);				$main1 = array();										$i = 0;					foreach($results_all as $row)					{							$id = $row['id'];						$sql1="SELECT * FROM tbl_flag WHERE pid=$id ORDER BY id ASC";						$main1[$i]['main'] = $row;						$main1[$i]['sub']= $this->getdbcontents_sql($sql1);						$i++;											}					return $main1 ;			}		}						public function getAllFlags_limit()		{				$sql="SELECT * FROM tbl_flag WHERE pid=0  ORDER BY id ASC ";		$results_all	= 	$this->getdbcontents_sql($sql);		$main1 = array();		$i = 0;			foreach($results_all as $row)			{					$id = $row['id'];				$sql1="SELECT * FROM tbl_flag WHERE pid=$id";								$main1[$i]['main'] = $row;				$main1[$i]['sub']= $this->getdbcontents_sql($sql1);				$i++;									}			return $main1 ;				}			public function delete_cat_sub($id)		{		$sql="SELECT * FROM tbl_flag WHERE pid=$id";		$result=$this->getdbcontents_sql($sql);				if($result)			{					return $message = "First Delete All The Sub Menus Please!!";			}		else			{					$i=0;				//$id.=',';				//$sql1="SELECT * FROM tbl_flagbook WHERE flag_id LIKE '%$id%'";																//$sql1="SELECT * FROM tbl_flagbook WHERE $id IN (flag_id)";				//$result1=$this->getdbcontents_sql($sql1);								//$result1=array();				$sql1="SELECT * FROM tbl_flagbook ";				$result	=	$this->getdbcontents_sql($sql1);				foreach($result as $row)					{										$res = $row['flag_id'];					$pieces = explode(",", $res);										foreach($pieces as $row1)					{						if($id==$row1)						{//echo $i;						//print_r($row);						 $result1[$i]=$row;												}						 $i++;					}										}//die();									//print_r($pieces) ;die();				//echo '<pre>';				//print_r($result);							///echo '</pre>';die();													//echo '<pre>';				//print_r($result1);				//echo '</pre>';die();				if($result1)					{						$_SESSION['isassociated_flagbook']='hi';												$result_all['message']="This flag is associated with following flagbook.Please first delete this flags from the following flag books first.";						$result_all['associated_flagbook']=$result1;						return $result_all;											}				else					{							$sql="DELETE FROM tbl_flag where id=$id";						$this->getdbcontents_sql($sql);						return $message = "Data Deleted Sucessfully!!";					}											}		}			public function addCatSubcat($values)		{				$insertFlag = 1;			$this->dbStartTrans();			$groupID =	$this->db_insert('tbl_flag',$values, 0);			if($groupID)			{	$message="Data Added Sucefully";				return $message;			}			else			{				return $message="Data Not Added ! Name already Exist . Please Enter Unique Name !!";			}		}					public function addflagbook($values)		{				$ids=implode(',',$values['flag_id']);			unset($values['flag_id']);			unset($values['submit']);			$values['flag_id']=$ids;			$insertFlag = 1;			$this->dbStartTrans();			$groupID =	$this->db_insert('tbl_flagbook',$values, 0);			if($groupID)			{	$message="Data Added Sucefully";				return $message;			}			else			{				return $message="Data Not Added";			}		}			public function getAllFlagsBooks()		{$result=array();		$sql="SELECT * FROM tbl_pmmfb_cost";		$all_flagbook=$this->getdbcontents_sql($sql);		$i=0;		foreach($all_flagbook as $row)		{	////$idarray=$row['flag_id'];			//$sql="SELECT name FROM tbl_flag WHERE id IN ($idarray)";			//$result[$i]['name']=$this->getdbcontents_sql($sql);			$result[$i]['flag_book_name']=$row['flag_book_name'];			$result[$i]['id']=$row['id'];			$result[$i]['take_percent']=$row['take_percent'];			$result[$i]['cost']=$row['cost'];						$i++;		}		return $result;		}			public function delete_flag_book($del_id)		{		$sql="DELETE FROM tbl_flagbook WHERE id=$del_id";		$result=$this->getdbcontents_sql($sql);		if($result)			{			return $message="Data Deleted Sucessfully.";			}						}			public function edit_flag_book_page($id)		{				$sql="SELECT * FROM tbl_flagbook where id=$id";		$all_flagbook=$this->getdbcontents_sql($sql);		$result=array();		foreach ($all_flagbook as $row)						{			$result['id']= $row['id'];			$result['flag_id']= $row['flag_id'];			$result['flag_book_name']= $row['flag_book_name'];			$result['take_percentage']= $row['take_percentage'];			}		$result['flag_id']=explode(',',$result['flag_id']);		return $result;				}					public function editflagbook_save($values)		{			$ids=implode(',',$values['flag_id']);			$edit_id=$values['edit_submit_id'];			unset($values['flag_id']);			unset($values['submit']);			unset($values['edit_submit_id']);			$values['flag_id']=$ids;			$Update=$this->db_update("tbl_flagbook",$values,"id=".$edit_id,0);						if($Update)				{					$message="Data Edited Sucefully";				return $message;				}			else				{				return $message="Data Not Edited";				}		}		}	?>